var font="Arial";function slideDate(b,a,c,d){return{date:b,dayName:a,primaryColor:c,accentColor:d,dateString:moment(b,"YYYY-MM-DD").format("dddd, MMMM Do")}}var background;function loadBackground(b,c){var a=new Image();a.crossOrigin="anonymous";a.onload=function(){background=a;c()};a.src=b}var logo;function loadLogo(b,c){var a=new Image();a.crossOrigin="anonymous";a.onload=function(){logo=a;c()};a.src=b}function makeSlide(g,j){var k=$("#edit-canvas")[0].getContext("2d");var a=1920,i=1080,d=a*0.72;k.canvas.width=a;k.canvas.height=i;k.drawImage(background,0,0,a,i);if(tinycolor(g.accentColor).isLight()){k.fillStyle="rgba(255, 255, 255, 0.8)"}else{k.fillStyle="rgba(0, 0, 0, 0.4)"}k.fillRect(0,0,a,i);k.fillStyle=g.primaryColor;k.fillRect(0,0,d,i);k.fillStyle=g.accentColor;var h=0.7,b=logo.height*h,e=logo.width*h,f=50;k.drawImage(logo,f,i-b-f,e,b);k.font="bold 295px "+font;k.fillText(g.dayName,30,270);k.font="bold 90px "+font;k.fillText(g.dateString,50,415);var c=i-40;j.forEach(function(l){k.fillStyle=g.accentColor;k.font="bold 40px "+font;k.textAlign="end";k.fillText(l.dayName,d-20,c);k.fillStyle=g.primaryColor;k.font="normal 40px "+font;k.textAlign="start";k.fillText(l.dateString,d+20,c);c-=55});return{name:g.date,image:k.canvas.toDataURL().slice(22)}}function makeCoverSlide(){var b=$("#edit-canvas")[0].getContext("2d");var c=1920,a=1080;b.canvas.width=c;b.canvas.height=a;b.drawImage(background,0,0,c,a);b.fillStyle="rgba(255, 255, 255, 0.6)";b.fillRect(0,0,c,a);b.fillStyle="yellow";b.fillRect(0,a,c,-100);b.fillStyle="#215192";b.font="bold 80px "+font;b.fillText("Welcome to",50,375);b.font="bold 140px "+font;b.fillText("Averill Park High School",50,550);b.fillStyle="#5580E7";b.font="normal 90px "+font;b.fillText("Home of the Warriors",50,675);return{name:"cover",image:b.canvas.toDataURL().slice(22)}}function makeZip(b){var a=new JSZip();b.forEach(function(c){a.file(c.name+".png",c.image,{base64:true})});a.generateAsync({type:"blob"}).then(function(c){saveAs(c,"slides.zip")})}function toast(b,c){var a=$(".toast");a.text(b);a.removeClass("show");a.addClass("show");setTimeout(function(){a.removeClass("show")},c)}var slideImages=[];function makeSlideBatch(b,a,c){var d=$("#make-progress .progress-bar");setTimeout(function(){b.reverse().forEach(function(e){slideImages.push(makeSlide(e,b))});d.text(a*5+"/"+c);d.width(a*5/c*100+"%")},a*2000)}$(document).ready(function(){$(":file").change(function(){var a=$(this),c=a.get(0).files?a.get(0).files.length:1,b=a.val().replace(/\\/g,"/").replace(/.*\//,"");$("[data-file-display="+this.id+"]").val(b)});loadBackground("img/aphs-front.jpg",function(){loadLogo("img/aphs-logo.png",function(){makeSlide(slideDate(moment().format("YYYY-MM-DD"),"B Day","yellow","black"),[slideDate(moment().add(5,"days").format("YYYY-MM-DD"),"A Day"),slideDate(moment().add(4,"days").format("YYYY-MM-DD"),"B Day"),slideDate(moment().add(3,"days").format("YYYY-MM-DD"),"A Day"),slideDate(moment().add(2,"days").format("YYYY-MM-DD"),"B Day"),slideDate(moment().add(1,"days").format("YYYY-MM-DD"),"A Day")])})});$("#csv").change(function(){$("#csv").parse({config:{skipEmptyLines:true,fastMode:true,complete:function(g,f){toast("Started making slides, please wait...",10000);var a=[];g.data.forEach(function(l){var i=l[0];var k=l[1];var j=l[2];var m=l[3];if(k==="A"){j="cornflowerblue"}else{if(k==="B"){j="yellow"}}if(k==="A"){m="white"}else{if(k==="B"){m="black"}}if(k==="A"){k="A Day"}else{if(k==="B"){k="B Day"}}a.push(slideDate(i,k,j,m))});var h=a.length;var c=5;var b=1;slideImages=[makeCoverSlide()];for(var e=0;e<h;e+=c){var d=a.slice(e,e+c);makeSlideBatch(d,b,h);b++;console.log(b)}setTimeout(function(){toast("Finished making slides, downloading as .zip file..",10000);makeZip(slideImages)},(b+1)*2000)},error:function(c,a,b,d){toast("Error reading .csv file!",10000)}}})})});